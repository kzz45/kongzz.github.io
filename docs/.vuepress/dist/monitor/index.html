<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>监控平台 | 运维管理平台</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="walle.png">
    <meta name="description" content="欢迎来到Walle运维管理平台">
    
    <link rel="preload" href="/assets/css/0.styles.e4d8b86b.css" as="style"><link rel="preload" href="/assets/js/app.4c1758d2.js" as="script"><link rel="preload" href="/assets/js/2.8790149a.js" as="script"><link rel="preload" href="/assets/js/3.2838422e.js" as="script"><link rel="prefetch" href="/assets/js/10.b82515b0.js"><link rel="prefetch" href="/assets/js/11.04ec3e7e.js"><link rel="prefetch" href="/assets/js/12.bd5d66fc.js"><link rel="prefetch" href="/assets/js/13.96e9b0da.js"><link rel="prefetch" href="/assets/js/14.8a2a7485.js"><link rel="prefetch" href="/assets/js/4.c046a1f7.js"><link rel="prefetch" href="/assets/js/5.030443da.js"><link rel="prefetch" href="/assets/js/6.c0f15ccd.js"><link rel="prefetch" href="/assets/js/7.174ea818.js"><link rel="prefetch" href="/assets/js/8.92b7ff6b.js"><link rel="prefetch" href="/assets/js/9.afce9de1.js">
    <link rel="stylesheet" href="/assets/css/0.styles.e4d8b86b.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">运维管理平台</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="运维平台" class="dropdown-title"><span class="title">运维平台</span> <span class="arrow down"></span></button> <button type="button" aria-label="运维平台" class="mobile-dropdown-title"><span class="title">运维平台</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/cmdb/" class="nav-link">
  资源管理
</a></li><li class="dropdown-item"><!----> <a href="/btree/" class="nav-link">
  业务管理
</a></li><li class="dropdown-item"><!----> <a href="/order/" class="nav-link">
  工单管理
</a></li><li class="dropdown-item"><!----> <a href="/jobs/" class="nav-link">
  作业平台
</a></li><li class="dropdown-item"><!----> <a href="/monitor/" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  监控平台
</a></li><li class="dropdown-item"><!----> <a href="/container/" class="nav-link">
  容器平台
</a></li><li class="dropdown-item"><!----> <a href="/settings/" class="nav-link">
  配置管理
</a></li></ul></div></div><div class="nav-item"><a href="https://github.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="运维平台" class="dropdown-title"><span class="title">运维平台</span> <span class="arrow down"></span></button> <button type="button" aria-label="运维平台" class="mobile-dropdown-title"><span class="title">运维平台</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/cmdb/" class="nav-link">
  资源管理
</a></li><li class="dropdown-item"><!----> <a href="/btree/" class="nav-link">
  业务管理
</a></li><li class="dropdown-item"><!----> <a href="/order/" class="nav-link">
  工单管理
</a></li><li class="dropdown-item"><!----> <a href="/jobs/" class="nav-link">
  作业平台
</a></li><li class="dropdown-item"><!----> <a href="/monitor/" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  监控平台
</a></li><li class="dropdown-item"><!----> <a href="/container/" class="nav-link">
  容器平台
</a></li><li class="dropdown-item"><!----> <a href="/settings/" class="nav-link">
  配置管理
</a></li></ul></div></div><div class="nav-item"><a href="https://github.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>监控平台</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/monitor/#技术栈" class="sidebar-link">技术栈</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/monitor/#产品架构图" class="sidebar-link">产品架构图</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/monitor/#前端说明" class="sidebar-link">前端说明</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/monitor/#监控大屏" class="sidebar-link">监控大屏</a></li><li class="sidebar-sub-header"><a href="/monitor/#告警维护" class="sidebar-link">告警维护</a></li><li class="sidebar-sub-header"><a href="/monitor/#告警列表" class="sidebar-link">告警列表</a></li><li class="sidebar-sub-header"><a href="/monitor/#监控对象" class="sidebar-link">监控对象</a></li><li class="sidebar-sub-header"><a href="/monitor/#告警配置" class="sidebar-link">告警配置</a></li><li class="sidebar-sub-header"><a href="/monitor/#监控管理" class="sidebar-link">监控管理</a></li></ul></li><li><a href="/monitor/#后端说明" class="sidebar-link">后端说明</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/monitor/#客户端说明" class="sidebar-link">客户端说明</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/monitor/#主要功能" class="sidebar-link">主要功能</a></li></ul></li><li><a href="/monitor/#一些exporter官方地址" class="sidebar-link">一些Exporter官方地址</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/monitor/#一些告警规则标准" class="sidebar-link">一些告警规则标准</a><ul class="sidebar-sub-headers"></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="监控平台"><a href="#监控平台" class="header-anchor">#</a> 监控平台</h1> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>监控平台基于Prometheus + (Thanos) + AlertManager + Grafana开发</p></div> <h2 id="技术栈"><a href="#技术栈" class="header-anchor">#</a> 技术栈</h2> <ul><li>服务端 Django RestFramework</li> <li>客户端 Go</li> <li>代理端 Go</li> <li>前端 Vue + Element</li></ul> <h2 id="产品架构图"><a href="#产品架构图" class="header-anchor">#</a> 产品架构图</h2> <p><img src="/assets/img/prometheus-architecture.7b47afdb.png" alt="监控架构图"></p> <h2 id="前端说明"><a href="#前端说明" class="header-anchor">#</a> 前端说明</h2> <h3 id="监控大屏"><a href="#监控大屏" class="header-anchor">#</a> 监控大屏</h3> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>监控大屏，主要显示某个产品下的告警(告警数量)，具体的告警详情可以点击查看，也可以针对告警设置维护。
如图</p></div> <p><img src="/assets/img/alert_wall.5a6bf9ed.png" alt="监控大屏"></p> <h3 id="告警维护"><a href="#告警维护" class="header-anchor">#</a> 告警维护</h3> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>告警维护页面，显示的是告警维护的策略列表，可以查看具体的维护策略，可以看到维护策略是否正在生效中。
如图</p></div> <p><img src="/assets/img/alert_maintain.a5dc1e53.png" alt="告警维护"></p> <h3 id="告警列表"><a href="#告警列表" class="header-anchor">#</a> 告警列表</h3> <blockquote><p>显示当前正在告警的告警信息，和已经恢复的告警信息，目的是记录下历史的告警。</p></blockquote> <h3 id="监控对象"><a href="#监控对象" class="header-anchor">#</a> 监控对象</h3> <blockquote><p>本次版本目前只支持主机实例，后续会增加如MySQL、Redis、域名、kubernetes、探测功能等等。</p></blockquote> <h3 id="告警配置"><a href="#告警配置" class="header-anchor">#</a> 告警配置</h3> <blockquote><p>告警配置是监控平台的重点，主要有：配置告警规则，配置告警路由，配置告警通知对象，监控任务(Prometheus中的Jobs)的管理。</p></blockquote> <h4 id="告警规则"><a href="#告警规则" class="header-anchor">#</a> 告警规则</h4> <blockquote><p>告警规则是重点，首先我们理想的状态是同一类型的告警只会配置一条告警规则，如果有细分的情况，我们针对主告警规则添加一些子规则。</p></blockquote> <p>🎉 💯 这条规则的意思是，所有目标实例离线，我们全局就只会配置这一条规则</p> <div class="language-promql extra-class"><pre class="language-promql"><code>up<span class="token context-labels"><span class="token punctuation">{</span><span class="token punctuation">}</span></span> <span class="token operator">==</span> <span class="token number">0</span>
</code></pre></div><p>💣 那么类似再加这一条规则就没有必要了</p> <div class="language-promql extra-class"><pre class="language-promql"><code>up<span class="token context-labels"><span class="token punctuation">{</span><span class="token label-key attr-name">_ip</span><span class="token punctuation">=</span><span class="token label-value attr-value">&quot;10.10.10.10&quot;</span><span class="token punctuation">}</span></span> <span class="token operator">==</span> <span class="token number">0</span>
</code></pre></div><h4 id="告警路由"><a href="#告警路由" class="header-anchor">#</a> 告警路由</h4> <blockquote><p>告警路由就是将哪些告警发送给哪些人，我们定义每个产品下面都会有一条默认的兜底的告警路由，也就是这个产品下的所有告警都会发送给
这个产品的运维人员。当然，也可以在这个产品下配置子路由，子路由可以配置覆盖父路由，意思就是匹配到这个子路由的情况下，这条告警
就会发送给这个子路由中配置的通知人员。</p></blockquote> <blockquote><p>告警路由最重要的点就是标签匹配</p></blockquote> <p><strong>父路由</strong>：这条路由规则的意思就是所有运维开发的告警信息发送给谁</p> <div class="language-promql extra-class"><pre class="language-promql"><code><span class="token context-labels"><span class="token punctuation">{</span><span class="token label-key attr-name">_product_name</span><span class="token punctuation">=</span><span class="token label-value attr-value">&quot;运维开发&quot;</span><span class="token punctuation">}</span></span>
</code></pre></div><p><strong>子路由</strong>：这条路由规则的意思就是运维开发下的关于CPU负载高的告警信息发送给谁</p> <div class="language- extra-class"><pre class="language-text"><code>{_product_name=&quot;运维开发&quot;, alertname=&quot;CPULoadHigh&quot;}
</code></pre></div><h4 id="告警通知组"><a href="#告警通知组" class="header-anchor">#</a> 告警通知组</h4> <blockquote><p>告警通知组，顾名思义就是接收告警信息的人员分组</p></blockquote> <h4 id="任务管理"><a href="#任务管理" class="header-anchor">#</a> 任务管理</h4> <blockquote><p>Prometheus配置文件中的scaped job, 就是抓取任务</p></blockquote> <h4 id="分组管理"><a href="#分组管理" class="header-anchor">#</a> 分组管理</h4> <blockquote><p>圈定一部分机器, 将机器分组, 同时分组自带有分组标签, 同时分组中可配置抓取任务</p> <p><a href="https://prometheus.io/docs/prometheus/latest/configuration/configuration/#scrape_config" target="_blank" rel="noopener noreferrer">官方解释<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></blockquote> <h3 id="监控管理"><a href="#监控管理" class="header-anchor">#</a> 监控管理</h3> <p><img src="/assets/img/monitor_settings.ed23955b.png" alt="监控管理说明"></p> <h4 id="采集组"><a href="#采集组" class="header-anchor">#</a> 采集组</h4> <blockquote><p>监控的代理节点 会封装Prometheus 服务端的一些配置会下发到这些代理节点上</p></blockquote> <h4 id="实例类型"><a href="#实例类型" class="header-anchor">#</a> 实例类型</h4> <blockquote><p>就是监控目标的类型 可以是机器 可以是数据库 可以是域名 可以是探测类型 等等</p> <p>就是一些官方的exporter 比如你需要Ping测检测 那么就需要一个ping exporter部署在某台机器上 那么这个机器上的exporter启动的服务就是一个探测节点</p></blockquote> <h4 id="探测节点"><a href="#探测节点" class="header-anchor">#</a> 探测节点</h4> <blockquote><p>比如Ping探测 或者域名探测 或者交换机探测 等等</p></blockquote> <h4 id="标签管理"><a href="#标签管理" class="header-anchor">#</a> 标签管理</h4> <blockquote><p>Prometheus很重要的一点就是标签 不同的PromQL包含标签</p></blockquote> <h4 id="告警规则类型管理"><a href="#告警规则类型管理" class="header-anchor">#</a> 告警规则类型管理</h4> <blockquote><p>我们定义了一些告警规则类型 比如主机类型 比如MySQL类型 等等 就是为了在告警规则管理中能明显看出规则的类型而已</p></blockquote> <h2 id="后端说明"><a href="#后端说明" class="header-anchor">#</a> 后端说明</h2> <h2 id="客户端说明"><a href="#客户端说明" class="header-anchor">#</a> 客户端说明</h2> <h3 id="主要功能"><a href="#主要功能" class="header-anchor">#</a> 主要功能</h3> <ul><li>基础Node Exporter封装</li> <li>端口监控</li> <li>进程监控</li> <li>脚本监控</li> <li>服务发现</li></ul> <h2 id="一些exporter官方地址"><a href="#一些exporter官方地址" class="header-anchor">#</a> 一些Exporter官方地址</h2> <ul><li><a href="https://github.com/prometheus/node_exporter" target="_blank" rel="noopener noreferrer">Node exporter<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://github.com/prometheus/blackbox_exporter" target="_blank" rel="noopener noreferrer">Blackbox exporter<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://github.com/prometheus/mysqld_exporter" target="_blank" rel="noopener noreferrer">MySQL Server Exporter<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://github.com/oliver006/redis_exporter" target="_blank" rel="noopener noreferrer">Redis Metrics Exporter<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://prometheus.io/docs/instrumenting/exporters/" target="_blank" rel="noopener noreferrer">Exporter 列表<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <h2 id="一些告警规则标准"><a href="#一些告警规则标准" class="header-anchor">#</a> 一些告警规则标准</h2> <ul><li><a href="https://awesome-prometheus-alerts.grep.to/" target="_blank" rel="noopener noreferrer">Prometheus Alert Rule Example<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">9/13/2021, 10:25:19 AM</span></div></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.4c1758d2.js" defer></script><script src="/assets/js/2.8790149a.js" defer></script><script src="/assets/js/3.2838422e.js" defer></script>
  </body>
</html>
