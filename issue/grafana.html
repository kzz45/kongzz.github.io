<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>监控平台之Grafana部署 | 运维管理平台</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="walle.png">
    <meta name="description" content="欢迎来到Walle运维管理平台">
    
    <link rel="preload" href="/oma/assets/css/0.styles.f7827f91.css" as="style"><link rel="preload" href="/oma/assets/js/app.b5f631cc.js" as="script"><link rel="preload" href="/oma/assets/js/2.e19be14c.js" as="script"><link rel="preload" href="/oma/assets/js/3.42bf8478.js" as="script"><link rel="prefetch" href="/oma/assets/js/10.449a0996.js"><link rel="prefetch" href="/oma/assets/js/11.c3a10ae9.js"><link rel="prefetch" href="/oma/assets/js/12.f2a1c9e9.js"><link rel="prefetch" href="/oma/assets/js/13.586f9e89.js"><link rel="prefetch" href="/oma/assets/js/14.7021a076.js"><link rel="prefetch" href="/oma/assets/js/15.eceab79c.js"><link rel="prefetch" href="/oma/assets/js/16.e4f15286.js"><link rel="prefetch" href="/oma/assets/js/17.efc62547.js"><link rel="prefetch" href="/oma/assets/js/18.88b4d838.js"><link rel="prefetch" href="/oma/assets/js/19.6d4a298d.js"><link rel="prefetch" href="/oma/assets/js/20.f916b03c.js"><link rel="prefetch" href="/oma/assets/js/21.aa79d71e.js"><link rel="prefetch" href="/oma/assets/js/22.deede7e6.js"><link rel="prefetch" href="/oma/assets/js/4.cdc0d0fe.js"><link rel="prefetch" href="/oma/assets/js/5.d9df3623.js"><link rel="prefetch" href="/oma/assets/js/6.77817641.js"><link rel="prefetch" href="/oma/assets/js/7.e7227ec0.js"><link rel="prefetch" href="/oma/assets/js/8.b3d03e0f.js"><link rel="prefetch" href="/oma/assets/js/9.1eb9fde1.js">
    <link rel="stylesheet" href="/oma/assets/css/0.styles.f7827f91.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/oma/" class="home-link router-link-active"><!----> <span class="site-name">运维管理平台</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/oma/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/oma/issue/" class="nav-link router-link-active">
  常见问题
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="运维平台" class="dropdown-title"><span class="title">运维平台</span> <span class="arrow down"></span></button> <button type="button" aria-label="运维平台" class="mobile-dropdown-title"><span class="title">运维平台</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/oma/cmdb/" class="nav-link">
  资源管理
</a></li><li class="dropdown-item"><!----> <a href="/oma/btree/" class="nav-link">
  业务管理
</a></li><li class="dropdown-item"><!----> <a href="/oma/order/" class="nav-link">
  工单管理
</a></li><li class="dropdown-item"><!----> <a href="/oma/jobs/" class="nav-link">
  作业平台
</a></li><li class="dropdown-item"><!----> <a href="/oma/monitor/" class="nav-link">
  监控平台
</a></li><li class="dropdown-item"><!----> <a href="/oma/container/" class="nav-link">
  容器平台
</a></li><li class="dropdown-item"><!----> <a href="/oma/settings/" class="nav-link">
  配置管理
</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/kzz45/oma" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/oma/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/oma/issue/" class="nav-link router-link-active">
  常见问题
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="运维平台" class="dropdown-title"><span class="title">运维平台</span> <span class="arrow down"></span></button> <button type="button" aria-label="运维平台" class="mobile-dropdown-title"><span class="title">运维平台</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/oma/cmdb/" class="nav-link">
  资源管理
</a></li><li class="dropdown-item"><!----> <a href="/oma/btree/" class="nav-link">
  业务管理
</a></li><li class="dropdown-item"><!----> <a href="/oma/order/" class="nav-link">
  工单管理
</a></li><li class="dropdown-item"><!----> <a href="/oma/jobs/" class="nav-link">
  作业平台
</a></li><li class="dropdown-item"><!----> <a href="/oma/monitor/" class="nav-link">
  监控平台
</a></li><li class="dropdown-item"><!----> <a href="/oma/container/" class="nav-link">
  容器平台
</a></li><li class="dropdown-item"><!----> <a href="/oma/settings/" class="nav-link">
  配置管理
</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/kzz45/oma" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>监控平台之Grafana部署</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/oma/issue/grafana.html#下载安装包" class="sidebar-link">下载安装包</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/oma/issue/grafana.html#grafana配置文件" class="sidebar-link">Grafana配置文件</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/oma/issue/grafana.html#启动服务" class="sidebar-link">启动服务</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/oma/issue/grafana.html#登录修改admin的密码" class="sidebar-link">登录修改admin的密码</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/oma/issue/grafana.html#导入node-exporter的dashboard" class="sidebar-link">导入Node Exporter的Dashboard</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/oma/issue/grafana.html#复制dashboard的id" class="sidebar-link">复制Dashboard的ID</a></li><li class="sidebar-sub-header"><a href="/oma/issue/grafana.html#导入grafana" class="sidebar-link">导入Grafana</a></li><li class="sidebar-sub-header"><a href="/oma/issue/grafana.html#细微修改dashboard的变量" class="sidebar-link">细微修改Dashboard的变量</a></li><li class="sidebar-sub-header"><a href="/oma/issue/grafana.html#效果图" class="sidebar-link">效果图</a></li></ul></li><li><a href="/oma/issue/grafana.html#邮件邀请用户" class="sidebar-link">邮件邀请用户</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/oma/issue/grafana.html#邀请例子" class="sidebar-link">邀请例子</a></li><li class="sidebar-sub-header"><a href="/oma/issue/grafana.html#邮件效果图" class="sidebar-link">邮件效果图</a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="监控平台之grafana部署"><a href="#监控平台之grafana部署" class="header-anchor">#</a> 监控平台之Grafana部署</h1> <h2 id="下载安装包"><a href="#下载安装包" class="header-anchor">#</a> 下载安装包</h2> <p><a href="https://grafana.com/grafana/download" target="_blank" rel="noopener noreferrer">官方下载地址<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>我们使用的是<strong>CentOS</strong>版本</p> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token function">wget</span> https://dl.grafana.com/enterprise/release/grafana-enterprise-8.1.3-1.x86_64.rpm
<span class="token function">sudo</span> yum <span class="token function">install</span> -y grafana-enterprise-8.1.3-1.x86_64.rpm
</code></pre></div><h2 id="grafana配置文件"><a href="#grafana配置文件" class="header-anchor">#</a> Grafana配置文件</h2> <p>主要配置如下</p> <div class="language-ini extra-class"><pre class="language-ini"><code><span class="token header"><span class="token punctuation">[</span><span class="token section-name selector">paths</span><span class="token punctuation">]</span></span>
<span class="token key attr-name">data</span> <span class="token punctuation">=</span> <span class="token value attr-value">/var/lib/grafana</span>
<span class="token key attr-name">logs</span> <span class="token punctuation">=</span> <span class="token value attr-value">/var/log/grafana</span>
<span class="token header"><span class="token punctuation">[</span><span class="token section-name selector">server</span><span class="token punctuation">]</span></span>
<span class="token key attr-name">http_addr</span> <span class="token punctuation">=</span> <span class="token value attr-value">0.0.0.0</span>
<span class="token key attr-name">http_port</span> <span class="token punctuation">=</span> <span class="token value attr-value">80</span>
<span class="token comment">; 我们使用MySQL来存储</span>
<span class="token header"><span class="token punctuation">[</span><span class="token section-name selector">database</span><span class="token punctuation">]</span></span>
<span class="token key attr-name">type</span> <span class="token punctuation">=</span> <span class="token value attr-value">mysql # 默认的是sqlite3</span>
<span class="token key attr-name">host</span> <span class="token punctuation">=</span> <span class="token value attr-value">mysql-host:3306</span>
<span class="token key attr-name">name</span> <span class="token punctuation">=</span> <span class="token value attr-value">grafana # MySQL数据库需要提前创建好</span>
<span class="token key attr-name">user</span> <span class="token punctuation">=</span> <span class="token value attr-value">user</span>
<span class="token key attr-name">password</span> <span class="token punctuation">=</span> <span class="token value attr-value">pasword</span>
<span class="token header"><span class="token punctuation">[</span><span class="token section-name selector">auth.anonymous</span><span class="token punctuation">]</span></span>
<span class="token key attr-name">enabled</span> <span class="token punctuation">=</span> <span class="token value attr-value">true # 允许匿名访问</span>
<span class="token key attr-name">org_name</span> <span class="token punctuation">=</span> <span class="token value attr-value">org-name # 允许匿名访问的组织名称(这里一定要写对)</span>
<span class="token key attr-name">org_role</span> <span class="token punctuation">=</span> <span class="token value attr-value">Viewer # 允许匿名访问的用户的权限是只读</span>
<span class="token comment">; 我们使用SMTP来发送邀请邮件或者告警邮件</span>
<span class="token header"><span class="token punctuation">[</span><span class="token section-name selector">smtp</span><span class="token punctuation">]</span></span>
<span class="token key attr-name">enabled</span> <span class="token punctuation">=</span> <span class="token value attr-value">true</span>
<span class="token key attr-name">host</span> <span class="token punctuation">=</span> <span class="token value attr-value">smtp地址:端口</span>
<span class="token key attr-name">user</span> <span class="token punctuation">=</span> <span class="token value attr-value">用户邮箱</span>
<span class="token key attr-name">password</span> <span class="token punctuation">=</span> <span class="token value attr-value">用户密码</span>
<span class="token key attr-name">skip_verify</span> <span class="token punctuation">=</span> <span class="token value attr-value">true</span>
<span class="token key attr-name">from_address</span> <span class="token punctuation">=</span> <span class="token value attr-value">发送邮件的用户的邮箱</span>
<span class="token key attr-name">from_name</span> <span class="token punctuation">=</span> <span class="token value attr-value">Grafana</span>
</code></pre></div><p>遇见问题：80端口的服务启动不了</p> <div class="language-sh extra-class"><pre class="language-sh"><code>setcap <span class="token string">'cap_net_bind_service=+ep'</span> /usr/sbin/grafana-server
</code></pre></div><h2 id="启动服务"><a href="#启动服务" class="header-anchor">#</a> 启动服务</h2> <div class="language-sh extra-class"><pre class="language-sh"><code>systemctl <span class="token builtin class-name">enable</span>  grafana-server
systemctl start  grafana-server
</code></pre></div><h2 id="登录修改admin的密码"><a href="#登录修改admin的密码" class="header-anchor">#</a> 登录修改admin的密码</h2> <blockquote><p>默认的登录用户名admin密码也是admin</p></blockquote> <h2 id="导入node-exporter的dashboard"><a href="#导入node-exporter的dashboard" class="header-anchor">#</a> 导入Node Exporter的Dashboard</h2> <p>我们使用的是<a href="https://grafana.com/grafana/dashboards/8919" target="_blank" rel="noopener noreferrer">1 Node Exporter for Prometheus Dashboard CN v20201010<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h3 id="复制dashboard的id"><a href="#复制dashboard的id" class="header-anchor">#</a> 复制Dashboard的ID</h3> <p><img src="/oma/assets/img/copy_dashboard_id.81d86b6f.png" alt=""></p> <h3 id="导入grafana"><a href="#导入grafana" class="header-anchor">#</a> 导入Grafana</h3> <p><img src="/oma/assets/img/dashboard_import.aa18ed4a.png" alt="步骤1"> <img src="/oma/assets/img/import_dashboard.c718698a.png" alt="步骤2"></p> <h3 id="细微修改dashboard的变量"><a href="#细微修改dashboard的变量" class="header-anchor">#</a> 细微修改Dashboard的变量</h3> <p><img src="/oma/assets/img/dashboard_variable.9bdc2f29.png" alt=""></p> <h3 id="效果图"><a href="#效果图" class="header-anchor">#</a> 效果图</h3> <p><img src="/oma/assets/img/node_exporter.23fe2c78.png" alt=""></p> <h2 id="邮件邀请用户"><a href="#邮件邀请用户" class="header-anchor">#</a> 邮件邀请用户</h2> <h3 id="邀请例子"><a href="#邀请例子" class="header-anchor">#</a> 邀请例子</h3> <p><img src="/oma/assets/img/invited_email.6d08126d.png" alt=""></p> <h3 id="邮件效果图"><a href="#邮件效果图" class="header-anchor">#</a> 邮件效果图</h3> <p><img src="/oma/assets/img/invite_user.0cbeb4e4.png" alt=""></p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">9/23/2021, 6:09:19 PM</span></div></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/oma/assets/js/app.b5f631cc.js" defer></script><script src="/oma/assets/js/2.e19be14c.js" defer></script><script src="/oma/assets/js/3.42bf8478.js" defer></script>
  </body>
</html>
