(window.webpackJsonp=window.webpackJsonp||[]).push([[4],{371:function(t,a,s){t.exports=s.p+"assets/img/prometheus.1fd653ce.png"},372:function(t,a,s){t.exports=s.p+"assets/img/prometheus_alertmanager.29351efb.png"},373:function(t,a,s){t.exports=s.p+"assets/img/alert_wall.5a6bf9ed.png"},374:function(t,a,s){t.exports=s.p+"assets/img/alert_maintain.a5dc1e53.png"},375:function(t,a,s){t.exports=s.p+"assets/img/monitor_settings.ed23955b.png"},398:function(t,a,s){"use strict";s.r(a);var e=s(44),r=Object(e.a)({},(function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("h1",{attrs:{id:"监控平台"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#监控平台"}},[t._v("#")]),t._v(" 监控平台")]),t._v(" "),e("div",{staticClass:"custom-block tip"},[e("p",{staticClass:"custom-block-title"},[t._v("TIP")]),t._v(" "),e("p",[t._v("监控平台基于Prometheus + (Thanos) + AlertManager + Grafana开发")])]),t._v(" "),e("h2",{attrs:{id:"技术栈"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#技术栈"}},[t._v("#")]),t._v(" 技术栈")]),t._v(" "),e("ul",[e("li",[t._v("服务端 Django RestFramework")]),t._v(" "),e("li",[t._v("客户端 Go")]),t._v(" "),e("li",[t._v("代理端 Go")]),t._v(" "),e("li",[t._v("前端 Vue + Element")])]),t._v(" "),e("h2",{attrs:{id:"产品逻辑图"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#产品逻辑图"}},[t._v("#")]),t._v(" 产品逻辑图")]),t._v(" "),e("p",[e("img",{attrs:{src:s(371),alt:"监控架构图"}})]),t._v(" "),e("h2",{attrs:{id:"产品架构图"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#产品架构图"}},[t._v("#")]),t._v(" 产品架构图")]),t._v(" "),e("p",[e("img",{attrs:{src:s(372),alt:"产品架构图"}})]),t._v(" "),e("h2",{attrs:{id:"前端说明"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#前端说明"}},[t._v("#")]),t._v(" 前端说明")]),t._v(" "),e("h3",{attrs:{id:"监控大屏"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#监控大屏"}},[t._v("#")]),t._v(" 监控大屏")]),t._v(" "),e("div",{staticClass:"custom-block tip"},[e("p",{staticClass:"custom-block-title"},[t._v("TIP")]),t._v(" "),e("p",[t._v("监控大屏，主要显示某个产品下的告警(告警数量)，具体的告警详情可以点击查看，也可以针对告警设置维护。\n如图")])]),t._v(" "),e("p",[e("img",{attrs:{src:s(373),alt:"监控大屏"}})]),t._v(" "),e("h3",{attrs:{id:"告警维护"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#告警维护"}},[t._v("#")]),t._v(" 告警维护")]),t._v(" "),e("div",{staticClass:"custom-block tip"},[e("p",{staticClass:"custom-block-title"},[t._v("TIP")]),t._v(" "),e("p",[t._v("告警维护页面，显示的是告警维护的策略列表，可以查看具体的维护策略，可以看到维护策略是否正在生效中。\n如图")])]),t._v(" "),e("p",[e("img",{attrs:{src:s(374),alt:"告警维护"}})]),t._v(" "),e("h3",{attrs:{id:"告警列表"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#告警列表"}},[t._v("#")]),t._v(" 告警列表")]),t._v(" "),e("blockquote",[e("p",[t._v("显示当前正在告警的告警信息，和已经恢复的告警信息，目的是记录下历史的告警。")])]),t._v(" "),e("h3",{attrs:{id:"监控对象"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#监控对象"}},[t._v("#")]),t._v(" 监控对象")]),t._v(" "),e("blockquote",[e("p",[t._v("本次版本目前只支持主机实例，后续会增加如MySQL、Redis、域名、kubernetes、探测功能等等。")])]),t._v(" "),e("h3",{attrs:{id:"告警配置"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#告警配置"}},[t._v("#")]),t._v(" 告警配置")]),t._v(" "),e("blockquote",[e("p",[t._v("告警配置是监控平台的重点，主要有：配置告警规则，配置告警路由，配置告警通知对象，监控任务(Prometheus中的Jobs)的管理。")])]),t._v(" "),e("h4",{attrs:{id:"告警规则"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#告警规则"}},[t._v("#")]),t._v(" 告警规则")]),t._v(" "),e("blockquote",[e("p",[t._v("告警规则是重点，首先我们理想的状态是同一类型的告警只会配置一条告警规则，如果有细分的情况，我们针对主告警规则添加一些子规则。")])]),t._v(" "),e("p",[t._v("🎉 💯 这条规则的意思是，所有目标实例离线，我们全局就只会配置这一条规则")]),t._v(" "),e("div",{staticClass:"language-promql extra-class"},[e("pre",{pre:!0,attrs:{class:"language-promql"}},[e("code",[t._v("up"),e("span",{pre:!0,attrs:{class:"token context-labels"}},[e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\n")])])]),e("p",[t._v("💣 那么类似再加这一条规则就没有必要了")]),t._v(" "),e("div",{staticClass:"language-promql extra-class"},[e("pre",{pre:!0,attrs:{class:"language-promql"}},[e("code",[t._v("up"),e("span",{pre:!0,attrs:{class:"token context-labels"}},[e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),e("span",{pre:!0,attrs:{class:"token label-key attr-name"}},[t._v("_ip")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),e("span",{pre:!0,attrs:{class:"token label-value attr-value"}},[t._v('"10.10.10.10"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\n")])])]),e("h4",{attrs:{id:"告警路由"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#告警路由"}},[t._v("#")]),t._v(" 告警路由")]),t._v(" "),e("blockquote",[e("p",[t._v("告警路由就是将哪些告警发送给哪些人，我们定义每个产品下面都会有一条默认的兜底的告警路由，也就是这个产品下的所有告警都会发送给\n这个产品的运维人员。当然，也可以在这个产品下配置子路由，子路由可以配置覆盖父路由，意思就是匹配到这个子路由的情况下，这条告警\n就会发送给这个子路由中配置的通知人员。")])]),t._v(" "),e("blockquote",[e("p",[t._v("告警路由最重要的点就是标签匹配")])]),t._v(" "),e("p",[e("strong",[t._v("父路由")]),t._v("：这条路由规则的意思就是所有运维开发的告警信息发送给谁")]),t._v(" "),e("div",{staticClass:"language-promql extra-class"},[e("pre",{pre:!0,attrs:{class:"language-promql"}},[e("code",[e("span",{pre:!0,attrs:{class:"token context-labels"}},[e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),e("span",{pre:!0,attrs:{class:"token label-key attr-name"}},[t._v("_product_name")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),e("span",{pre:!0,attrs:{class:"token label-value attr-value"}},[t._v('"运维开发"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v("\n")])])]),e("p",[e("strong",[t._v("子路由")]),t._v("：这条路由规则的意思就是运维开发下的关于CPU负载高的告警信息发送给谁")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v('{_product_name="运维开发", alertname="CPULoadHigh"}\n')])])]),e("h4",{attrs:{id:"告警通知组"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#告警通知组"}},[t._v("#")]),t._v(" 告警通知组")]),t._v(" "),e("blockquote",[e("p",[t._v("告警通知组，顾名思义就是接收告警信息的人员分组")])]),t._v(" "),e("h4",{attrs:{id:"任务管理"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#任务管理"}},[t._v("#")]),t._v(" 任务管理")]),t._v(" "),e("blockquote",[e("p",[t._v("Prometheus配置文件中的scaped job, 就是抓取任务")])]),t._v(" "),e("h4",{attrs:{id:"分组管理"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#分组管理"}},[t._v("#")]),t._v(" 分组管理")]),t._v(" "),e("blockquote",[e("p",[t._v("圈定一部分机器, 将机器分组, 同时分组自带有分组标签, 同时分组中可配置抓取任务")]),t._v(" "),e("p",[e("a",{attrs:{href:"https://prometheus.io/docs/prometheus/latest/configuration/configuration/#scrape_config",target:"_blank",rel:"noopener noreferrer"}},[t._v("官方解释"),e("OutboundLink")],1)])]),t._v(" "),e("h3",{attrs:{id:"监控管理"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#监控管理"}},[t._v("#")]),t._v(" 监控管理")]),t._v(" "),e("p",[e("img",{attrs:{src:s(375),alt:"监控管理说明"}})]),t._v(" "),e("h4",{attrs:{id:"采集组"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#采集组"}},[t._v("#")]),t._v(" 采集组")]),t._v(" "),e("blockquote",[e("p",[t._v("监控的代理节点，会封装Prometheus，服务端的一些配置会下发到这些代理节点上")])]),t._v(" "),e("div",{staticClass:"custom-block tip"},[e("p",{staticClass:"custom-block-title"},[t._v("TIP")]),t._v(" "),e("ul",[e("li",[t._v("哪些机器挂载在这个采集组上")]),t._v(" "),e("li",[t._v("采集组分为两种类型：自定义和API同步")]),t._v(" "),e("li",[t._v("自定义类型，绑定的机器需要手动配置")]),t._v(" "),e("li",[t._v("API同步类型，API地址内就是采集的目标机器的UUID列表")]),t._v(" "),e("li",[t._v("每个采集组下面会配置一个采集节点(Prometheus)")])])]),t._v(" "),e("h4",{attrs:{id:"采集节点"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#采集节点"}},[t._v("#")]),t._v(" 采集节点")]),t._v(" "),e("blockquote",[e("p",[t._v("也就是Prometheus服务节点")])]),t._v(" "),e("ul",[e("li",[t._v("标识：必须唯一，后续Prometheus配置文件中会用到")])]),t._v(" "),e("div",{staticClass:"language-yml extra-class"},[e("pre",{pre:!0,attrs:{class:"language-yml"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 全局配置")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("global")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("scrape_interval")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 60s\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("evaluation_interval")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 60s\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("scrape_timeout")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 50s\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("external_labels")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("monitor")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"sh"')]),t._v(" "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 标识会用在这里")]),t._v("\n")])])]),e("ul",[e("li",[t._v("地址：Prometheus的HTTP地址")]),t._v(" "),e("li",[t._v("唯一ID：必须唯一")])]),t._v(" "),e("h4",{attrs:{id:"实例类型"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#实例类型"}},[t._v("#")]),t._v(" 实例类型")]),t._v(" "),e("blockquote",[e("p",[t._v("就是监控目标的类型，可以是机器 可以是数据库 可以是域名 可以是探测类型 等等")])]),t._v(" "),e("h4",{attrs:{id:"探测节点"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#探测节点"}},[t._v("#")]),t._v(" 探测节点")]),t._v(" "),e("blockquote",[e("p",[t._v("就是一些官方的exporter，比如你需要Ping测检测 那么就需要一个ping exporter部署在某台机器上 那么这个机器上的exporter启动的服务就是一个探测节点")])]),t._v(" "),e("blockquote",[e("p",[t._v("比如Ping探测 或者域名探测 或者交换机探测 等等")])]),t._v(" "),e("h4",{attrs:{id:"标签管理"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#标签管理"}},[t._v("#")]),t._v(" 标签管理")]),t._v(" "),e("blockquote",[e("p",[t._v("Prometheus很重要的一点就是标签，不同的PromQL包含标签，会定义不同的告警语句或者告警路由")])]),t._v(" "),e("h4",{attrs:{id:"告警规则类型管理"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#告警规则类型管理"}},[t._v("#")]),t._v(" 告警规则类型管理")]),t._v(" "),e("blockquote",[e("p",[t._v("我们定义了一些告警规则类型 比如主机类型 比如MySQL类型 等等 就是为了在告警规则管理中能明显看出规则的类型而已")])]),t._v(" "),e("h2",{attrs:{id:"后端说明"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#后端说明"}},[t._v("#")]),t._v(" 后端说明")]),t._v(" "),e("h3",{attrs:{id:"启动后端服务"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#启动后端服务"}},[t._v("#")]),t._v(" 启动后端服务")]),t._v(" "),e("div",{staticClass:"language-sh extra-class"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[t._v("python3 manage.py runserver\n")])])]),e("h3",{attrs:{id:"启动异步服务"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#启动异步服务"}},[t._v("#")]),t._v(" 启动异步服务")]),t._v(" "),e("ul",[e("li",[t._v("同步实例")])]),t._v(" "),e("div",{staticClass:"language-sh extra-class"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[t._v("python3 monitor_worker.py sync_instance_to_db\n")])])]),e("ul",[e("li",[t._v("绑定实例到采集组")])]),t._v(" "),e("div",{staticClass:"language-sh extra-class"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[t._v("python3 monitor_worker.py bind_instance_to_task\n")])])]),e("ul",[e("li",[t._v("生成任务")])]),t._v(" "),e("div",{staticClass:"language-sh extra-class"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[t._v("python3 monitor_worker.py make_instance_tasks\n")])])]),e("ul",[e("li",[t._v("同步告警信息")])]),t._v(" "),e("div",{staticClass:"language-sh extra-class"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[t._v("python3 monitor_worker.py sync_alerts\n")])])]),e("ul",[e("li",[t._v("同步当前正在告警的信息")])]),t._v(" "),e("div",{staticClass:"language-sh extra-class"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[t._v("python3 monitor_worker.py sync_current_alert\n")])])]),e("h2",{attrs:{id:"客户端说明"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#客户端说明"}},[t._v("#")]),t._v(" 客户端说明")]),t._v(" "),e("h3",{attrs:{id:"主要功能"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#主要功能"}},[t._v("#")]),t._v(" 主要功能")]),t._v(" "),e("ul",[e("li",[t._v("基础Node Exporter封装")]),t._v(" "),e("li",[t._v("端口监控")]),t._v(" "),e("li",[t._v("进程监控")]),t._v(" "),e("li",[t._v("脚本监控")]),t._v(" "),e("li",[t._v("服务发现")])]),t._v(" "),e("h2",{attrs:{id:"exporter官方地址"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#exporter官方地址"}},[t._v("#")]),t._v(" Exporter官方地址")]),t._v(" "),e("ul",[e("li",[e("a",{attrs:{href:"https://github.com/prometheus/node_exporter",target:"_blank",rel:"noopener noreferrer"}},[t._v("Node exporter"),e("OutboundLink")],1)]),t._v(" "),e("li",[e("a",{attrs:{href:"https://github.com/prometheus/blackbox_exporter",target:"_blank",rel:"noopener noreferrer"}},[t._v("Blackbox exporter"),e("OutboundLink")],1)]),t._v(" "),e("li",[e("a",{attrs:{href:"https://github.com/prometheus/mysqld_exporter",target:"_blank",rel:"noopener noreferrer"}},[t._v("MySQL Server Exporter"),e("OutboundLink")],1)]),t._v(" "),e("li",[e("a",{attrs:{href:"https://github.com/oliver006/redis_exporter",target:"_blank",rel:"noopener noreferrer"}},[t._v("Redis Metrics Exporter"),e("OutboundLink")],1)]),t._v(" "),e("li",[e("a",{attrs:{href:"https://prometheus.io/docs/instrumenting/exporters/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Exporter 列表"),e("OutboundLink")],1)])]),t._v(" "),e("h2",{attrs:{id:"告警规则标准"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#告警规则标准"}},[t._v("#")]),t._v(" 告警规则标准")]),t._v(" "),e("ul",[e("li",[e("a",{attrs:{href:"https://awesome-prometheus-alerts.grep.to/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Prometheus Alert Rule Example"),e("OutboundLink")],1)])])])}),[],!1,null,null,null);a.default=r.exports}}]);